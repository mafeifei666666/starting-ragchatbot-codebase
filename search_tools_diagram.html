<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>search_tools.py æ¶æ„å›¾</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #f1f5f9;
            padding: 2rem;
            margin: 0;
        }
        h1, h2 {
            color: #60a5fa;
            margin-top: 2rem;
        }
        .mermaid {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        .description {
            background: #1e293b;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #60a5fa;
        }
        .code-section {
            background: #1e293b;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        .highlight {
            color: #fbbf24;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ“š search_tools.py æ¶æ„è§£æ</h1>

    <div class="description">
        <strong>æ–‡ä»¶ä½œç”¨ï¼š</strong>è¿™ä¸ªæ–‡ä»¶å®ç°äº†OpenAIå·¥å…·è°ƒç”¨ï¼ˆTool Callingï¼‰ç³»ç»Ÿï¼Œå…è®¸AIå†³å®šä½•æ—¶æœç´¢è¯¾ç¨‹å†…å®¹ã€‚
    </div>

    <h2>1ï¸âƒ£ ç±»ç»“æ„å±‚æ¬¡</h2>
    <div class="mermaid">
        classDiagram
            class Tool {
                &lt;&lt;abstract&gt;&gt;
                +get_tool_definition() Dict
                +execute(kwargs) str
            }

            class CourseSearchTool {
                -VectorStore store
                -list last_sources
                +get_tool_definition() Dict
                +execute(query, course_name, lesson_number) str
                -format_results(results) str
            }

            class ToolManager {
                -dict tools
                +register_tool(tool)
                +get_tool_definitions() list
                +execute_tool(tool_name, kwargs) str
                +get_last_sources() list
                +reset_sources()
            }

            Tool <|-- CourseSearchTool : ç»§æ‰¿
            ToolManager o-- Tool : ç®¡ç†
    </div>

    <h2>2ï¸âƒ£ å·¥ä½œæµç¨‹</h2>
    <div class="mermaid">
        sequenceDiagram
            participant AI as OpenAI GPT
            participant TM as ToolManager
            participant CST as CourseSearchTool
            participant VS as VectorStore

            Note over AI,TM: 1. æ³¨å†Œé˜¶æ®µ
            TM->>CST: register_tool(search_tool)
            CST->>TM: è¿”å›å·¥å…·å®šä¹‰

            Note over AI,TM: 2. AIè°ƒç”¨é˜¶æ®µ
            AI->>TM: "æˆ‘éœ€è¦æœç´¢MCPè¯¾ç¨‹çš„Lesson 3å†…å®¹"
            TM->>CST: execute(query="...", course_name="MCP", lesson_number=3)
            CST->>VS: search(query, course_name, lesson_number)
            VS->>CST: SearchResults
            CST->>CST: _format_results(results)
            CST->>CST: ä¿å­˜ last_sources
            CST->>TM: æ ¼å¼åŒ–çš„ç»“æœæ–‡æœ¬
            TM->>AI: æœç´¢ç»“æœ

            Note over AI,TM: 3. è·å–æ¥æº
            TM->>CST: get_last_sources()
            CST->>TM: [{text, url}, ...]
    </div>

    <h2>3ï¸âƒ£ å·¥å…·å®šä¹‰ç»“æ„ï¼ˆOpenAIæ ¼å¼ï¼‰</h2>
    <div class="mermaid">
        graph TD
            A[Tool Definition] --> B[type: 'function']
            A --> C[function]
            C --> D[name: 'search_course_content']
            C --> E[description: å·¥å…·è¯´æ˜]
            C --> F[parameters]
            F --> G[query: string <span class='highlight'>å¿…éœ€</span>]
            F --> H[course_name: string <span class='highlight'>å¯é€‰</span>]
            F --> I[lesson_number: integer <span class='highlight'>å¯é€‰</span>]

            style A fill:#60a5fa,color:#000
            style C fill:#34d399,color:#000
            style F fill:#fbbf24,color:#000
    </div>

    <h2>4ï¸âƒ£ æ•°æ®æµè½¬</h2>
    <div class="mermaid">
        flowchart LR
            A[ç”¨æˆ·æŸ¥è¯¢] --> B[AIå†³å®šè°ƒç”¨å·¥å…·]
            B --> C[search_course_content]
            C --> D{æœ‰è¯¾ç¨‹åè¿‡æ»¤?}
            D -->|æ˜¯| E[è¯­ä¹‰åŒ¹é…è¯¾ç¨‹å]
            D -->|å¦| F[æœç´¢æ‰€æœ‰è¯¾ç¨‹]
            E --> G{æœ‰è¯¾ç¨‹å·è¿‡æ»¤?}
            F --> G
            G -->|æ˜¯| H[åªè¿”å›è¯¥è¯¾ç¨‹ç»“æœ]
            G -->|å¦| I[è¿”å›æ‰€æœ‰ç›¸å…³ç»“æœ]
            H --> J[æ ¼å¼åŒ–ç»“æœ]
            I --> J
            J --> K[ä¿å­˜æ¥æºä¿¡æ¯]
            K --> L[è¿”å›ç»™AI]
            L --> M[AIç”Ÿæˆæœ€ç»ˆå›ç­”]

            style A fill:#60a5fa,color:#000
            style C fill:#34d399,color:#000
            style J fill:#fbbf24,color:#000
            style M fill:#f87171,color:#000
    </div>

    <h2>5ï¸âƒ£ æ ¸å¿ƒæ–¹æ³•è¯¦è§£</h2>

    <div class="description">
        <h3>Tool (æŠ½è±¡åŸºç±»)</h3>
        <div class="code-section">
            <span class="highlight">get_tool_definition()</span>: è¿”å›å·¥å…·çš„OpenAIæ ¼å¼å®šä¹‰<br>
            <span class="highlight">execute(**kwargs)</span>: æ‰§è¡Œå·¥å…·é€»è¾‘
        </div>
    </div>

    <div class="description">
        <h3>CourseSearchTool</h3>
        <div class="code-section">
            <span class="highlight">__init__(vector_store)</span>: åˆå§‹åŒ–ï¼Œæ¥æ”¶VectorStoreå®ä¾‹<br>
            <span class="highlight">get_tool_definition()</span>: è¿”å›search_course_contentå·¥å…·å®šä¹‰<br>
            <span class="highlight">execute(query, course_name?, lesson_number?)</span>: <br>
            &nbsp;&nbsp;- è°ƒç”¨vector_store.search()<br>
            &nbsp;&nbsp;- å¤„ç†é”™è¯¯å’Œç©ºç»“æœ<br>
            &nbsp;&nbsp;- æ ¼å¼åŒ–ç»“æœ<br>
            <span class="highlight">_format_results(results)</span>: <br>
            &nbsp;&nbsp;- ä¸ºæ¯ä¸ªç»“æœæ·»åŠ [è¯¾ç¨‹å - Lesson X]å¤´éƒ¨<br>
            &nbsp;&nbsp;- æå–è¯¾ç¨‹é“¾æ¥å’Œè¯¾ç¨‹é“¾æ¥<br>
            &nbsp;&nbsp;- ä¿å­˜sourcesåˆ°last_sources<br>
            &nbsp;&nbsp;- è¿”å›æ ¼å¼åŒ–æ–‡æœ¬
        </div>
    </div>

    <div class="description">
        <h3>ToolManager</h3>
        <div class="code-section">
            <span class="highlight">register_tool(tool)</span>: æ³¨å†Œå·¥å…·åˆ°toolså­—å…¸<br>
            <span class="highlight">get_tool_definitions()</span>: è¿”å›æ‰€æœ‰å·¥å…·å®šä¹‰åˆ—è¡¨ï¼ˆä¼ ç»™OpenAI APIï¼‰<br>
            <span class="highlight">execute_tool(tool_name, **kwargs)</span>: æ ¹æ®åç§°æ‰§è¡ŒæŒ‡å®šå·¥å…·<br>
            <span class="highlight">get_last_sources()</span>: è·å–æœ€åä¸€æ¬¡æœç´¢çš„æ¥æºåˆ—è¡¨<br>
            <span class="highlight">reset_sources()</span>: æ¸…ç©ºæ‰€æœ‰å·¥å…·çš„æ¥æº
        </div>
    </div>

    <h2>6ï¸âƒ£ æœç´¢ç»“æœæ ¼å¼åŒ–ç¤ºä¾‹</h2>
    <div class="description">
        <strong>è¾“å…¥ï¼š</strong>SearchResults with 2 documents<br><br>
        <strong>æ ¼å¼åŒ–åè¾“å‡ºï¼š</strong>
        <div class="code-section">
            [MCP: Build Rich-Context AI Apps - Lesson 3]<br>
            This lesson covers the concept of resources in MCP...<br>
            <br>
            [MCP: Build Rich-Context AI Apps - Lesson 5]<br>
            Advanced patterns for using MCP in production...
        </div>
        <strong>åŒæ—¶ä¿å­˜çš„sourcesï¼š</strong>
        <div class="code-section">
            [<br>
            &nbsp;&nbsp;{text: "MCP: Build Rich-Context AI Apps - Lesson 3", url: "https://..."},<br>
            &nbsp;&nbsp;{text: "MCP: Build Rich-Context AI Apps - Lesson 5", url: "https://..."}<br>
            ]
        </div>
    </div>

    <h2>7ï¸âƒ£ ä¸å…¶ä»–æ¨¡å—çš„å…³ç³»</h2>
    <div class="mermaid">
        graph TB
            A[app.py] --> B[ToolManager]
            A --> C[RAGSystem]
            B --> D[CourseSearchTool]
            D --> E[VectorStore]
            C --> F[AIGenerator]
            F --> G[OpenAI API]
            G --> B
            B --> G

            style A fill:#60a5fa,color:#000
            style B fill:#34d399,color:#000
            style D fill:#fbbf24,color:#000
            style G fill:#f87171,color:#fff
    </div>

    <div class="description">
        <strong>å·¥ä½œæµç¨‹ï¼š</strong>
        <ol>
            <li><code>app.py</code> åˆ›å»º <code>ToolManager</code> å’Œ <code>CourseSearchTool</code></li>
            <li>å°†å·¥å…·å®šä¹‰ä¼ é€’ç»™ <code>OpenAI API</code></li>
            <li>AIå†³å®šä½•æ—¶è°ƒç”¨ <code>search_course_content</code></li>
            <li><code>ToolManager</code> æ‰§è¡Œ <code>CourseSearchTool</code></li>
            <li>ç»“æœè¿”å›ç»™AIç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</li>
            <li>Sourcesè¿”å›ç»™å‰ç«¯æ˜¾ç¤º</li>
        </ol>
    </div>

    <h2>8ï¸âƒ£ OpenAIå·¥å…·è°ƒç”¨å…³é”®ç‚¹</h2>
    <div class="description">
        <strong>ä¸Anthropicçš„åŒºåˆ«ï¼š</strong>
        <ul>
            <li>å·¥å…·å®šä¹‰æ ¼å¼ï¼š<code>{"type": "function", "function": {...}}</code></li>
            <li>å·¥å…·åç§°åµŒå¥—ï¼š<code>tool_def["function"]["name"]</code></li>
            <li>å‚æ•°å­—æ®µï¼šä½¿ç”¨ <code>parameters</code> è€Œä¸æ˜¯ <code>input_schema</code></li>
            <li>æ¶ˆæ¯æ ¼å¼ï¼šå·¥å…·ç»“æœç”¨ <code>role: "tool"</code></li>
        </ul>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#60a5fa',
                primaryTextColor: '#000',
                primaryBorderColor: '#1e293b',
                lineColor: '#94a3b8',
                secondaryColor: '#34d399',
                tertiaryColor: '#fbbf24'
            }
        });
    </script>
</body>
</html>
